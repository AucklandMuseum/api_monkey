import os
import requests
import json
import key
from clarifai.client import ClarifaiApi


url = "http://api.aucklandmuseum.com/search/collectionsonline/_search"
payload = "{\n    \"fields\" : [\"primaryRepresentation\"],\n    \"query\" : {\n        \"term\" : { \"primaryRepresentation\" : \"http\"}\n    }\n}\n"
headers = {
    'content-type': "application/json",
    }
AMrecord = requests.request("POST", url, data=payload, headers=headers)

##set python environment vars for clarifai api authentification and initiate API instance
os.environ['CLARIFAI_APP_ID']= key.CLARIFAI_APP_ID
os.environ['CLARIFAI_APP_SECRET']=key.CLARIFAI_APP_SECRET
clarifai_api = ClarifaiApi()
imageList=[]
##-------------------------GET FILES--------
## search query searching for 'keyword' related images in the AM photography collection

#keyword='beer'

parsed_json = json.loads(AMrecord.text)

#print parsed_json

for i in range (len(parsed_json)):
    imagelink = parsed_json ["hits"]["hits"][i]["fields"]['primaryRepresentation']
    print imagelink

##-------------------------RUN QUERIES--------

##  query ClarifAI API and receive back results.
for i in range (len(imagelink)):

    ## Parse JSON file. The ClarifAI API response is interpreted a combination of nested dicts and lists by Python.
    object = clarifai_api.tag_image_urls(imagelink[i])
    results = object.get('results')
    firstNode = results[0]
    result= firstNode.get('result')
    tag = result.get('tag')
    classes=tag.get('classes')  #these are the actual tags generated by ClarifAI

    ## print results
    print imagelink[i] +', ',

    for i in range (len(classes)):
        print str(classes[i]),",",

    print '\n'
